/*!
 * aimaraeditor.js
 *
 * @brief
 * AIMARA editor is a js tool for editing AIMARA values. It is based on
 * JSONEditor by Jos de Jong, but without any affiliation or connection
 * to its author.
 *
 * Supported browsers: Chrome, Firefox, Safari, Opera, Internet Explorer 8+
 *
 * @license
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 * Copyright (c) 2014 Daniel Moisset, http://machinalis.com/
 * Copyright (c) 2011-2014 Jos de Jong
 *
 * @author  Daniel Moisset, dmoisset@machinalis.com
 * @version 3.1.2
 * @date    2015-03-02
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.JSONEditor=t():e.JSONEditor=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var n,o;n=[i(1),i(2)],o=function(e,t){function i(e,n,o,s){if(!(this instanceof i))throw new Error('JSONEditor constructor called without "new".');var r=t.getInternetExplorerVersion();if(-1!=r&&9>r)throw new Error("Unsupported browser, IE9 or newer required. Please install the newest version of your browser.");arguments.length&&this._create(e,n,o,s)}return i.modes={},i.prototype._create=function(e,t,i,n){this.container=e,this.options=t||{},this.options.knownConstructors=t.knownConstructors||{},this.value=i,this.type=n;var o=this.options.mode||"tree";this.setMode(o)},i.prototype._delete=function(){},i.prototype.set=function(e){this.value=e},i.prototype.get=function(){return this.value},i.prototype.setName=function(e){this.options||(this.options={}),this.options.name=e},i.prototype.getName=function(){return this.options&&this.options.name},i.prototype.setMode=function(e){var n,o,s=this.container,r=t.extend({},this.options);r.mode=e;var a=i.modes[e];if(!a)throw new Error('Unknown mode "'+r.mode+'"');try{if(o=this.getName(),n=this.get(),this._delete(),t.extend(this,a.mixin),this.create(s,r),this.setName(o),this.set(n),"function"==typeof a.load)try{a.load.call(this)}catch(l){}}catch(l){this._onError(l)}},i.prototype._onError=function(e){if("function"==typeof this.onError&&(t.log("WARNING: JSONEditor.onError is deprecated. Use options.error instead."),this.onError(e)),!this.options||"function"!=typeof this.options.error)throw e;this.options.error(e)},i.registerMode=function(e){var n,o;if(t.isArray(e))for(n=0;n<e.length;n++)i.registerMode(e[n]);else{if(!("mode"in e))throw new Error('Property "mode" missing');if(!("mixin"in e))throw new Error('Property "mixin" missing');var s=e.mode;if(s in i.modes)throw new Error('Mode "'+s+'" already registered');if("function"!=typeof e.mixin.create)throw new Error('Required function "create" missing on mixin');var r=["setMode","registerMode","modes"];for(n=0;n<r.length;n++)if(o=r[n],o in e.mixin)throw new Error('Reserved property "'+o+'" not allowed in mixin');i.modes[s]=e}},i.registerMode(e),i}.apply(t,n),!(void 0!==o&&(e.exports=o))},function(e,t,i){var n,o;n=[i(3),i(4),i(5),i(6),i(2)],o=function(e,t,i,n,o){var s={};s.create=function(i,n){if(!i)throw new Error("No container element provided.");this.container=i,this.dom={},this.highlighter=new e,this.selection=void 0,this._setOptions(n),this.options.history&&"view"!==this.options.mode&&(this.history=new t(this)),this._createFrame(),this._createTable()},s._delete=function(){this.frame&&this.container&&this.frame.parentNode==this.container&&this.container.removeChild(this.frame)},s._setOptions=function(e){if(this.options={search:!0,history:!0,mode:"tree",name:void 0},e)for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])};var r=void 0,a=null;return s.set=function(e){if(e instanceof Function||void 0===e)this.clear();else{this.content.removeChild(this.table);var t={field:this.options.name,value:e,type:this.type},i=new n(this,t);this._setRoot(i);var o=!1;this.node.expand(o),this.content.appendChild(this.table)}this.history&&this.history.clear()},s.get=function(){return r&&r.blur(),this.node?this.node.getValue():void 0},s.setName=function(e){this.options.name=e,this.node&&this.node.updateField(this.options.name)},s.getName=function(){return this.options.name},s.clear=function(){this.node&&(this.node.collapse(),this.tbody.removeChild(this.node.getDom()),delete this.node)},s._setRoot=function(e){this.clear(),this.node=e,this.tbody.appendChild(e.getDom())},s.search=function(e){var t;return this.node?(this.content.removeChild(this.table),t=this.node.search(e),this.content.appendChild(this.table)):t=[],t},s.expandAll=function(){this.node&&(this.content.removeChild(this.table),this.node.expand(),this.content.appendChild(this.table))},s.collapseAll=function(){this.node&&(this.content.removeChild(this.table),this.node.collapse(),this.content.appendChild(this.table))},s._onAction=function(e,t){if(this.history&&this.history.add(e,t),this.options.change)try{this.options.change()}catch(i){o.log("Error in change callback: ",i)}},s.startAutoScroll=function(e){var t=this,i=this.content,n=o.getAbsoluteTop(i),s=i.clientHeight,r=n+s,a=24,l=50;this.autoScrollStep=n+a>e&&i.scrollTop>0?(n+a-e)/3:e>r-a&&s+i.scrollTop<i.scrollHeight?(r-a-e)/3:void 0,this.autoScrollStep?this.autoScrollTimer||(this.autoScrollTimer=setInterval(function(){t.autoScrollStep?i.scrollTop-=t.autoScrollStep:t.stopAutoScroll()},l)):this.stopAutoScroll()},s.stopAutoScroll=function(){this.autoScrollTimer&&(clearTimeout(this.autoScrollTimer),delete this.autoScrollTimer),this.autoScrollStep&&delete this.autoScrollStep},s.setSelection=function(e){e&&("scrollTop"in e&&this.content&&(this.content.scrollTop=e.scrollTop),e.range&&o.setSelectionOffset(e.range),e.dom&&e.dom.focus())},s.getSelection=function(){return{dom:a,scrollTop:this.content?this.content.scrollTop:0,range:o.getSelectionOffset()}},s.scrollTo=function(e,t){var i=this.content;if(i){var n=this;n.animateTimeout&&(clearTimeout(n.animateTimeout),delete n.animateTimeout),n.animateCallback&&(n.animateCallback(!1),delete n.animateCallback);var o=i.clientHeight,s=i.scrollHeight-o,r=Math.min(Math.max(e-o/4,0),s),a=function(){var e=i.scrollTop,o=r-e;Math.abs(o)>3?(i.scrollTop+=o/3,n.animateCallback=t,n.animateTimeout=setTimeout(a,50)):(t&&t(!0),i.scrollTop=r,delete n.animateTimeout,delete n.animateCallback)};a()}else t&&t(!1)},s._createFrame=function(){function e(e){t._onEvent(e)}this.frame=document.createElement("div"),this.frame.className="jsoneditor",this.container.appendChild(this.frame);var t=this;this.frame.onclick=function(t){var i=t.target;e(t),"BUTTON"==i.nodeName&&t.preventDefault()},this.frame.oninput=e,this.frame.onchange=e,this.frame.onkeydown=e,this.frame.onkeyup=e,this.frame.oncut=e,this.frame.onpaste=e,this.frame.onmousedown=e,this.frame.onmouseup=e,this.frame.onmouseover=e,this.frame.onmouseout=e,o.addEventListener(this.frame,"focus",e,!0),o.addEventListener(this.frame,"blur",e,!0),this.frame.onfocusin=e,this.frame.onfocusout=e,this.menu=document.createElement("div"),this.menu.className="menu",this.frame.appendChild(this.menu);var n=document.createElement("button");n.className="expand-all",n.title="Expand all fields",n.onclick=function(){t.expandAll()},this.menu.appendChild(n);var s=document.createElement("button");if(s.title="Collapse all fields",s.className="collapse-all",s.onclick=function(){t.collapseAll()},this.menu.appendChild(s),this.history){var r=document.createElement("button");r.className="undo separator",r.title="Undo last action (Ctrl+Z)",r.onclick=function(){t._onUndo()},this.menu.appendChild(r),this.dom.undo=r;var a=document.createElement("button");a.className="redo",a.title="Redo (Ctrl+Shift+Z)",a.onclick=function(){t._onRedo()},this.menu.appendChild(a),this.dom.redo=a,this.history.onChange=function(){r.disabled=!t.history.canUndo(),a.disabled=!t.history.canRedo()},this.history.onChange()}this.options.search&&(this.searchBox=new i(this,this.menu))},s._onUndo=function(){this.history&&(this.history.undo(),this.options.change&&this.options.change())},s._onRedo=function(){this.history&&(this.history.redo(),this.options.change&&this.options.change())},s._onEvent=function(e){var t=e.target;"keydown"==e.type&&this._onKeyDown(e),"focus"==e.type&&(a=t);var i=n.getNodeFromTarget(t);i&&(i.onEvent(e),"click"==e.type&&this.options.click&&this.options.click(i))},s._onKeyDown=function(e){var t=e.which||e.keyCode,i=e.ctrlKey,n=e.shiftKey,s=!1;if(9==t&&setTimeout(function(){o.selectContentEditable(a)},0),this.searchBox)if(i&&70==t)this.searchBox.dom.search.focus(),this.searchBox.dom.search.select(),s=!0;else if(114==t||i&&71==t){var r=!0;n?this.searchBox.previous(r):this.searchBox.next(r),s=!0}this.history&&(i&&!n&&90==t?(this._onUndo(),s=!0):i&&n&&90==t&&(this._onRedo(),s=!0)),s&&(e.preventDefault(),e.stopPropagation())},s._createTable=function(){var e=document.createElement("div");e.className="outer",this.contentOuter=e,this.content=document.createElement("div"),this.content.className="tree",e.appendChild(this.content),this.table=document.createElement("table"),this.table.className="tree",this.content.appendChild(this.table);var t;this.colgroupContent=document.createElement("colgroup"),t=document.createElement("col"),t.width="24px",this.colgroupContent.appendChild(t),t=document.createElement("col"),this.colgroupContent.appendChild(t),this.table.appendChild(this.colgroupContent),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.frame.appendChild(e)},[{mode:"tree",mixin:s,data:"value"}]}.apply(t,n),!(void 0!==o&&(e.exports=o))},function(e,t,i){var n;n=function(){var e={};e.parse=function(t){try{return JSON.parse(t)}catch(i){try{return e.parseJS(t)}catch(n){throw e.validate(t),i}}},e.parseJS=function(e){for(var t=[],i=!1,n=0;n<e.length;){var o=e.charAt(n),s="\\"===e.charAt(n-1);'"'!==o&&"'"!==o||s||(o===i?i=!1:i?t.push("\\"):i=o),t.push(o),n++}var r=t.join("");return r=r.replace(/(.?)'/g,function(e,t){return"\\"==t?"'":t+'"'}),r=r.replace(/([{,]\s*)([a-zA-Z_][a-zA-Z0-9_]*)(\s*:)/g,function(e,t,i,n){return t+'"'+i+'"'+n}),JSON.parse(r)},e.validate=function(e){"undefined"!=typeof jsonlint?jsonlint.parse(e):JSON.parse(e)},e.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},e.clear=function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t];return e},e.log=function(){"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)},e.type=function(t){return null===t?"null":void 0===t?"undefined":t instanceof Number||"number"==typeof t?"number":t instanceof String||"string"==typeof t?"string":t instanceof Boolean||"boolean"==typeof t?"boolean":t instanceof RegExp||"regexp"==typeof t?"regexp":e.isArray(t)?"array":"object"};var t=/^https?:\/\/\S+$/;e.isUrl=function(e){return("string"==typeof e||e instanceof String)&&t.test(e)},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.getAbsoluteLeft=function(e){var t=e.getBoundingClientRect();return t.left+window.pageXOffset||document.scrollLeft||0},e.getAbsoluteTop=function(e){var t=e.getBoundingClientRect();return t.top+window.pageYOffset||document.scrollTop||0},e.addClassName=function(e,t){var i=e.className.split(" ");-1==i.indexOf(t)&&(i.push(t),e.className=i.join(" "))},e.removeClassName=function(e,t){var i=e.className.split(" "),n=i.indexOf(t);-1!=n&&(i.splice(n,1),e.className=i.join(" "))},e.stripFormatting=function(t){for(var i=t.childNodes,n=0,o=i.length;o>n;n++){var s=i[n];s.style&&s.removeAttribute("style");var r=s.attributes;if(r)for(var a=r.length-1;a>=0;a--){var l=r[a];1==l.specified&&s.removeAttribute(l.name)}e.stripFormatting(s)}},e.setEndOfContentEditable=function(e){var t,i;document.createRange&&(t=document.createRange(),t.selectNodeContents(e),t.collapse(!1),i=window.getSelection(),i.removeAllRanges(),i.addRange(t))},e.selectContentEditable=function(e){if(e&&"DIV"==e.nodeName){var t,i;window.getSelection&&document.createRange&&(i=document.createRange(),i.selectNodeContents(e),t=window.getSelection(),t.removeAllRanges(),t.addRange(i))}},e.getSelection=function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}return null},e.setSelection=function(e){if(e&&window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}},e.getSelectionOffset=function(){var t=e.getSelection();return t&&"startOffset"in t&&"endOffset"in t&&t.startContainer&&t.startContainer==t.endContainer?{startOffset:t.startOffset,endOffset:t.endOffset,container:t.startContainer.parentNode}:null},e.setSelectionOffset=function(t){if(document.createRange&&window.getSelection){var i=window.getSelection();if(i){var n=document.createRange();n.setStart(t.container.firstChild,t.startOffset),n.setEnd(t.container.firstChild,t.endOffset),e.setSelection(n)}}},e.getInnerText=function(t,i){var n=void 0==i;if(n&&(i={text:"",flush:function(){var e=this.text;return this.text="",e},set:function(e){this.text=e}}),t.nodeValue)return i.flush()+t.nodeValue;if(t.hasChildNodes()){for(var o=t.childNodes,s="",r=0,a=o.length;a>r;r++){var l=o[r];if("DIV"==l.nodeName||"P"==l.nodeName){var h=o[r-1],d=h?h.nodeName:void 0;d&&"DIV"!=d&&"P"!=d&&"BR"!=d&&(s+="\n",i.flush()),s+=e.getInnerText(l,i),i.set("\n")}else"BR"==l.nodeName?(s+=i.flush(),i.set("\n")):s+=e.getInnerText(l,i)}return s}return"P"==t.nodeName&&-1!=e.getInternetExplorerVersion()?i.flush():""},e.getInternetExplorerVersion=function(){if(-1==i){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(t)&&(e=parseFloat(RegExp.$1))}i=e}return i},e.isFirefox=function(){return-1!=navigator.userAgent.indexOf("Firefox")};var i=-1;return e.addEventListener=function(t,i,n,o){if(t.addEventListener)return void 0===o&&(o=!1),"mousewheel"===i&&e.isFirefox()&&(i="DOMMouseScroll"),t.addEventListener(i,n,o),n;if(t.attachEvent){var s=function(){return n.call(t,window.event)};return t.attachEvent("on"+i,s),s}},e.removeEventListener=function(t,i,n,o){t.removeEventListener?(void 0===o&&(o=!1),"mousewheel"===i&&e.isFirefox()&&(i="DOMMouseScroll"),t.removeEventListener(i,n,o)):t.detachEvent&&t.detachEvent("on"+i,n)},e}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n;n=function(){function e(){this.locked=!1}return e.prototype.highlight=function(e){this.locked||(this.node!=e&&(this.node&&this.node.setHighlight(!1),this.node=e,this.node.setHighlight(!0)),this._cancelUnhighlight())},e.prototype.unhighlight=function(){if(!this.locked){var e=this;this.node&&(this._cancelUnhighlight(),this.unhighlightTimer=setTimeout(function(){e.node.setHighlight(!1),e.node=void 0,e.unhighlightTimer=void 0},0))}},e.prototype._cancelUnhighlight=function(){this.unhighlightTimer&&(clearTimeout(this.unhighlightTimer),this.unhighlightTimer=void 0)},e.prototype.lock=function(){this.locked=!0},e.prototype.unlock=function(){this.locked=!1},e}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n,o;n=[i(2)],o=function(e){function t(e){this.editor=e,this.clear(),this.actions={editField:{undo:function(e){e.node.updateField(e.oldValue)},redo:function(e){e.node.updateField(e.newValue)}},editValue:{undo:function(e){e.node.updateValue(e.oldValue)},redo:function(e){e.node.updateValue(e.newValue)}},appendNode:{undo:function(e){e.parent.removeChild(e.node)},redo:function(e){e.parent.appendChild(e.node)}},insertBeforeNode:{undo:function(e){e.parent.removeChild(e.node)},redo:function(e){e.parent.insertBefore(e.node,e.beforeNode)}},insertAfterNode:{undo:function(e){e.parent.removeChild(e.node)},redo:function(e){e.parent.insertAfter(e.node,e.afterNode)}},removeNode:{undo:function(e){var t=e.parent,i=t.childs[e.index]||t.append;t.insertBefore(e.node,i)},redo:function(e){e.parent.removeChild(e.node)}},duplicateNode:{undo:function(e){e.parent.removeChild(e.clone)},redo:function(e){e.parent.insertAfter(e.clone,e.node)}},moveNode:{undo:function(e){e.startParent.moveTo(e.node,e.startIndex)},redo:function(e){e.endParent.moveTo(e.node,e.endIndex)}}}}return t.prototype.onChange=function(){},t.prototype.add=function(e,t){this.index++,this.history[this.index]={action:e,params:t,timestamp:new Date},this.index<this.history.length-1&&this.history.splice(this.index+1,this.history.length-this.index-1),this.onChange()},t.prototype.clear=function(){this.history=[],this.index=-1,this.onChange()},t.prototype.canUndo=function(){return this.index>=0},t.prototype.canRedo=function(){return this.index<this.history.length-1},t.prototype.undo=function(){if(this.canUndo()){var t=this.history[this.index];if(t){var i=this.actions[t.action];i&&i.undo?(i.undo(t.params),t.params.oldSelection&&this.editor.setSelection(t.params.oldSelection)):e.log('Error: unknown action "'+t.action+'"')}this.index--,this.onChange()}},t.prototype.redo=function(){if(this.canRedo()){this.index++;var t=this.history[this.index];if(t){var i=this.actions[t.action];i&&i.redo?(i.redo(t.params),t.params.newSelection&&this.editor.setSelection(t.params.newSelection)):e.log('Error: unknown action "'+t.action+'"')}this.onChange()}},t}.apply(t,n),!(void 0!==o&&(e.exports=o))},function(e,t,i){var n;n=function(){function e(e,t){var i=this;this.editor=e,this.timeout=void 0,this.delay=200,this.lastText=void 0,this.dom={},this.dom.container=t;var n=document.createElement("table");this.dom.table=n,n.className="search",t.appendChild(n);var o=document.createElement("tbody");this.dom.tbody=o,n.appendChild(o);var s=document.createElement("tr");o.appendChild(s);var r=document.createElement("td");s.appendChild(r);var a=document.createElement("div");this.dom.results=a,a.className="results",r.appendChild(a),r=document.createElement("td"),s.appendChild(r);var l=document.createElement("div");this.dom.input=l,l.className="frame",l.title="Search fields and values",r.appendChild(l);var h=document.createElement("table");l.appendChild(h);var d=document.createElement("tbody");h.appendChild(d),s=document.createElement("tr"),d.appendChild(s);var c=document.createElement("button");c.className="refresh",r=document.createElement("td"),r.appendChild(c),s.appendChild(r);var p=document.createElement("input");this.dom.search=p,p.oninput=function(e){i._onDelayedSearch(e)},p.onchange=function(e){i._onSearch(e)},p.onkeydown=function(e){i._onKeyDown(e)},p.onkeyup=function(e){i._onKeyUp(e)},c.onclick=function(){p.select()},r=document.createElement("td"),r.appendChild(p),s.appendChild(r);var u=document.createElement("button");u.title="Next result (Enter)",u.className="next",u.onclick=function(){i.next()},r=document.createElement("td"),r.appendChild(u),s.appendChild(r);var f=document.createElement("button");f.title="Previous result (Shift+Enter)",f.className="previous",f.onclick=function(){i.previous()},r=document.createElement("td"),r.appendChild(f),s.appendChild(r)}return e.prototype.next=function(e){if(void 0!=this.results){var t=void 0!=this.resultIndex?this.resultIndex+1:0;t>this.results.length-1&&(t=0),this._setActiveResult(t,e)}},e.prototype.previous=function(e){if(void 0!=this.results){var t=this.results.length-1,i=void 0!=this.resultIndex?this.resultIndex-1:t;0>i&&(i=t),this._setActiveResult(i,e)}},e.prototype._setActiveResult=function(e,t){if(this.activeResult){var i=this.activeResult.node,n=this.activeResult.elem;"field"==n?delete i.searchFieldActive:delete i.searchValueActive,i.updateDom()}if(!this.results||!this.results[e])return this.resultIndex=void 0,void(this.activeResult=void 0);this.resultIndex=e;var o=this.results[this.resultIndex].node,s=this.results[this.resultIndex].elem;"field"==s?o.searchFieldActive=!0:o.searchValueActive=!0,this.activeResult=this.results[this.resultIndex],o.updateDom(),o.scrollTo(function(){t&&o.focus(s)})},e.prototype._clearDelay=function(){void 0!=this.timeout&&(clearTimeout(this.timeout),delete this.timeout)},e.prototype._onDelayedSearch=function(){this._clearDelay();var e=this;this.timeout=setTimeout(function(t){e._onSearch(t)},this.delay)},e.prototype._onSearch=function(e,t){this._clearDelay();var i=this.dom.search.value,n=i.length>0?i:void 0;if(n!=this.lastText||t)if(this.lastText=n,this.results=this.editor.search(n),this._setActiveResult(void 0),void 0!=n){var o=this.results.length;switch(o){case 0:this.dom.results.innerHTML="no&nbsp;results";break;case 1:this.dom.results.innerHTML="1&nbsp;result";break;default:this.dom.results.innerHTML=o+"&nbsp;results"}}else this.dom.results.innerHTML=""},e.prototype._onKeyDown=function(e){var t=e.which;27==t?(this.dom.search.value="",this._onSearch(e),e.preventDefault(),e.stopPropagation()):13==t&&(e.ctrlKey?this._onSearch(e,!0):e.shiftKey?this.previous():this.next(),e.preventDefault(),e.stopPropagation())},e.prototype._onKeyUp=function(e){var t=e.keyCode;27!=t&&13!=t&&this._onDelayedSearch(e)},e}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))},function(e,t,i){var n,o;n=[i(7),i(2)],o=function(e,t){function i(e){return e===Object(e)}function n(e){return null===e?"Null":"boolean"==typeof e?"Boolean":"number"==typeof e?"Number":"string"==typeof e?"String":e instanceof Array?"[Anything]":i(e)?void 0!==e.__label__?"Constructor":"{Anything}":void 0}function o(e,t,i,n){this.type=e,this.label=t,this.children=i,this.defaultValue=n}function s(e){var t=new o("Anything","",[],null);return"Null"===e?new o(e,"",[],null):"Boolean"===e?new o(e,"",[],!1):"Number"===e?new o(e,"",[],0):"String"===e?new o(e,"",[],""):"[Anything]"===e?new o("List","",[t],[]):"{Anything}"===e?new o("Dict","",[t],{}):void 0}function r(e,t){this.editor=e,this.dom={},this.expanded=!1,t&&t instanceof Object?(this.setField(t.field,t.fieldEditable),this.setValue(t.value,t.type)):(this.setField(""),this.setValue(null))}o.prototype.getType=function(){return this.type},o.prototype.getLabel=function(){return this.label},o.prototype.getChildren=function(){return this.children},o.prototype.buildDefaultValue=function(){return this.defaultValue},r.prototype._updateEditability=function(){if(this.editable={field:!0,value:!0},this.editor&&(this.editable.field="tree"===this.editor.options.mode,this.editable.value="view"!==this.editor.options.mode,"tree"===this.editor.options.mode&&"function"==typeof this.editor.options.editable)){var e=this.editor.options.editable({field:this.field,value:this.value,path:this.path()});"boolean"==typeof e?(this.editable.field=e,this.editable.value=e):("boolean"==typeof e.field&&(this.editable.field=e.field),"boolean"==typeof e.value&&(this.editable.value=e.value))}},r.prototype.path=function(){for(var e=this,t=[];e;){var i=void 0!=e.field?e.field:e.index;void 0!==i&&t.unshift(i),e=e.parent}return t},r.prototype.setParent=function(e){this.parent=e},r.prototype.setField=function(e,t){this.field=e,this.fieldEditable=1==t},r.prototype.getField=function(){return void 0===this.field&&this._getDomField(),this.field},r.prototype.addConstructorChildren=function(e,t,i){for(var n,o,s,a=e.getChildren(),l=0,h=a.length;h>l;l++)s=a[l].getFieldName(),(void 0===t[s]||null===t[s])&&(i.push("Missing field: "+s),t[s]=a[l].buildDefaultValue()),o=t[s],n=new r(this.editor,{field:s,value:o,type:a[l]}),this.appendChild(n)},r.prototype.addListChildren=function(e,t){for(var i,n,o=0,s=t.length;s>o;o++)n=t[o],i=new r(this.editor,{value:n,type:e}),this.appendChild(i)},r.prototype.addDictChildren=function(e,t){var i,n;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],void 0===n||n instanceof Function||(i=new r(this.editor,{field:o,value:n,type:e}),this.appendChild(i)))},r.prototype.setValue=function(e,t){var i,o=[],a=this.childs;if(a)for(;a.length;)this.removeChild(a[0]);this.type=t||this.type;if(this.type)if("List"==this.type.getType())e instanceof Array||(o.push("Invalid value, expected a list."),e=this.type.buildDefaultValue()),this.childs=[],this.addListChildren(this.type.getChildren()[0],e),this.value=e;else if("Constructor"==this.type.getType())(!(e instanceof Object)||e instanceof Array)&&(o.push("Invalid value, expected a "+this.type.getLabel()+"."),e=this.type.buildDefaultValue()),this.childs=[],this.addConstructorChildren(this.type,e,o),this.value=e;else if("Choice"==this.type.getType()){this.childs=[];var l=this.type.getChildren();choiceFound=!1;try{for(var h=0,d=l.length;d>h;h++)if(l[h].getLabel()==e.getLabel()){choiceFound=!0;break}}catch(c){}if(!choiceFound){for(var p=[],u=0,f=l.length;f>u;u++)p.push(l[u].getLabel());o.push("Invalid value, expected a valid choice between "+p.join(", ")+"."),e=this.type.buildDefaultValue(),h=0}var m=l[h];this.addConstructorChildren(m,e,o),this.value=e}else if("Anything"==this.type.getType()){this.childs=[];var v,g=n(e);v="Constructor"===g?this.editor.options.knownConstructors[e.__label__]:s(g),i=new r(this.editor,{field:"value",value:e,type:v}),this.appendChild(i),this.value=e}else"Dict"==this.type.getType()?(this.childs=[],(!(e instanceof Object)||e instanceof Array)&&(o.push("Invalid value, expected a Dict."),e=this.type.buildDefaultValue()),this.addDictChildren(this.type.getChildren()[0],e),this.value=e):"Null"==this.type.getType()?(null!==e&&(o.push("Invalid value, expected a Null."),e=this.type.buildDefaultValue()),this.childs=void 0,this.value=e):(this.childs=void 0,this.value=e);else this.childs=void 0,this.value=null;if(this.editor&&this.editor.options&&"function"==typeof this.editor.options.error)for(var h=0;h<o.length;h++)this.editor.options.error(o[h])},r.prototype.getArrayFromChildren=function(){var e=[];return this.childs.forEach(function(t){e.push(t.getValue())}),e},r.prototype.getDictFromChildren=function(){var e={};return this.childs.forEach(function(t){e[t.getField()]=t.getValue()}),e},r.prototype.getAimaraValueFromChildren=function(){var e=this.value;return this.childs.forEach(function(t){e[t.getField()]=t.getValue()}),e},r.prototype.getValue=function(){return"List"==this.type.getType()?this.getArrayFromChildren():"Dict"==this.type.getType()?this.getDictFromChildren():"Constructor"==this.type.getType()||"Choice"==this.type.getType()?this.getAimaraValueFromChildren():"Anything"==this.type.getType()?this.childs[0].getValue():(void 0===this.value&&this._getDomValue(),this.value)},r.prototype.getLevel=function(){return this.parent?this.parent.getLevel()+1:0},r.prototype.clone=function(){var e=new r(this.editor);if(e.type=this.type,e.field=this.field,e.fieldInnerText=this.fieldInnerText,e.fieldEditable=this.fieldEditable,e.value=this.value,e.expanded=this.expanded,this.childs){var t=[];this.childs.forEach(function(i){var n=i.clone();n.setParent(e),t.push(n)}),e.childs=t}else e.childs=void 0;return e},r.prototype.expand=function(e){this.childs&&(this.expanded=!0,this.dom.expand&&(this.dom.expand.className="expanded"),this.showChilds(),0!=e&&this.childs.forEach(function(t){t.expand(e)}))},r.prototype.collapse=function(e){this.childs&&(this.hideChilds(),0!=e&&this.childs.forEach(function(t){t.collapse(e)}),this.dom.expand&&(this.dom.expand.className="collapsed"),this.expanded=!1)},r.prototype.showChilds=function(){var e=this.childs;if(e&&this.expanded){var t=this.dom.tr,i=t?t.parentNode:void 0;if(i){var n=this.getAppend(),o=t.nextSibling;o?i.insertBefore(n,o):i.appendChild(n),this.childs.forEach(function(e){i.insertBefore(e.getDom(),n),e.showChilds()})}}},r.prototype.hide=function(){var e=this.dom.tr,t=e?e.parentNode:void 0;t&&t.removeChild(e),this.hideChilds()},r.prototype.hideChilds=function(){var e=this.childs;if(e&&this.expanded){var t=this.getAppend();t.parentNode&&t.parentNode.removeChild(t),this.childs.forEach(function(e){e.hide()})}},r.prototype.appendChild=function(e){if(this._hasChilds()){if(e.setParent(this),e.fieldEditable="Dict"==this.type.getType(),"List"==this.type.getType()&&(e.index=this.childs.length),this.childs.push(e),this.expanded){var t=e.getDom(),i=this.getAppend(),n=i?i.parentNode:void 0;i&&n&&n.insertBefore(t,i),e.showChilds()}this.updateDom({updateIndexes:!0}),e.updateDom({recurse:!0})}},r.prototype.moveBefore=function(e,t){if(this._hasChilds()){var i=this.dom.tr?this.dom.tr.parentNode:void 0;if(i){var n=document.createElement("tr");n.style.height=i.clientHeight+"px",i.appendChild(n)}e.parent&&e.parent.removeChild(e),t instanceof a?this.appendChild(e):this.insertBefore(e,t),i&&i.removeChild(n)}},r.prototype.moveTo=function(e,t){if(e.parent==this){var i=this.childs.indexOf(e);t>i&&t++}var n=this.childs[t]||this.append;this.moveBefore(e,n)},r.prototype.insertBefore=function(e,t){if(this._hasChilds()){if(t==this.append)e.setParent(this),e.fieldEditable="Dict"==this.type.getType(),this.childs.push(e);else{var i=this.childs.indexOf(t);if(-1==i)throw new Error("Node not found");e.setParent(this),e.fieldEditable="Dict"==this.type.getType(),this.childs.splice(i,0,e)}if(this.expanded){var n=e.getDom(),o=t.getDom(),s=o?o.parentNode:void 0;o&&s&&s.insertBefore(n,o),e.showChilds()}this.updateDom({updateIndexes:!0}),e.updateDom({recurse:!0})}},r.prototype.insertAfter=function(e,t){if(this._hasChilds()){var i=this.childs.indexOf(t),n=this.childs[i+1];n?this.insertBefore(e,n):this.appendChild(e)}},r.prototype.search=function(e){var t,i=[],n=e?e.toLowerCase():void 0;if(delete this.searchField,delete this.searchValue,void 0!=this.field){var o=String(this.field).toLowerCase();t=o.indexOf(n),-1!=t&&(this.searchField=!0,i.push({node:this,elem:"field"})),this._updateDomField()}if(this._hasChilds()){if(this.childs){var s=[];this.childs.forEach(function(t){s=s.concat(t.search(e))}),i=i.concat(s)}if(void 0!=n){var r=!1;0==s.length?this.collapse(r):this.expand(r)}}else{if(void 0!=this.value){var a=String(this.value).toLowerCase();t=a.indexOf(n),-1!=t&&(this.searchValue=!0,i.push({node:this,elem:"value"}))}this._updateDomValue()}return i},r.prototype.scrollTo=function(e){if(!this.dom.tr||!this.dom.tr.parentNode)for(var t=this.parent,i=!1;t;)t.expand(i),t=t.parent;this.dom.tr&&this.dom.tr.parentNode&&this.editor.scrollTo(this.dom.tr.offsetTop,e)},r.focusElement=void 0,r.prototype.focus=function(e){if(r.focusElement=e,this.dom.tr&&this.dom.tr.parentNode){var i=this.dom;switch(e){case"drag":i.drag&&i.drag.focus();break;case"expand":this._hasChilds()?i.expand.focus():i.field&&this.fieldEditable?(i.field.focus(),t.selectContentEditable(i.field)):i.value&&!this._hasChilds()?(i.value.focus(),t.selectContentEditable(i.value)):i.drag.focus();break;case"field":i.field&&this.fieldEditable?(i.field.focus(),t.selectContentEditable(i.field)):i.value&&!this._hasChilds()?(i.value.focus(),t.selectContentEditable(i.value)):this._hasChilds()?i.expand.focus():i.drag.focus();break;case"value":default:i.value&&!this._hasChilds()?(i.value.focus(),t.selectContentEditable(i.value)):i.field&&this.fieldEditable?(i.field.focus(),t.selectContentEditable(i.field)):this._hasChilds()?i.expand.focus():i.drag.focus()}}},r.select=function(e){setTimeout(function(){t.selectContentEditable(e)},0)},r.prototype.blur=function(){this._getDomValue(!1),this._getDomField(!1)},r.prototype._duplicate=function(e){var t=e.clone();return this.insertAfter(t,e),t},r.prototype.containsNode=function(e){if(this==e)return!0;var t=this.childs;if(t)for(var i=0,n=t.length;n>i;i++)if(t[i].containsNode(e))return!0;return!1},r.prototype._move=function(e,t){if(e!=t){if(e.containsNode(this))throw new Error("Cannot move a field into a child of itself");e.parent&&e.parent.removeChild(e);var i=e.clone();e.clearDom(),t?this.insertBefore(i,t):this.appendChild(i)}},r.prototype.removeChild=function(e){if(this.childs){var t=this.childs.indexOf(e);if(-1!=t){e.hide(),delete e.searchField,delete e.searchValue;var i=this.childs.splice(t,1)[0];return this.updateDom({updateIndexes:!0}),i}}return void 0},r.prototype._remove=function(e){this.removeChild(e)},r.prototype._getDomValue=function(e){if(!this.hidding){var i,n;if("Choice"===this.type.getType()||"Anything"===this.type.getType()){var n=this.value,o=null,r=this.dom.value.options[this.dom.value.selectedIndex].value;if("Choice"===this.type.getType()){for(var a=0;a<this.type.getChildren().length&&this.type.getChildren()[a].getLabel()!==r;a++);o=this.type.getChildren()[a].buildDefaultValue()}else if("Anything"===this.type.getType())if("Number"!==r&&"String"!==r&&"Boolean"!==r&&"Null"!==r&&"[Anything]"!==r&&"{Anything}"!==r)o=this.editor.options.knownConstructors[r].buildDefaultValue();else{var l=s(r);o=l.buildDefaultValue()}var h,d=this.dom.tr?this.dom.tr.parentNode:void 0;h=this.expanded?this.getAppend():this.getDom();var c=h&&h.parentNode?h.nextSibling:void 0;this.hidding=!0,this.hide(),this.hidding=!1,this.clearDom(),this.childs.forEach(function(e){e.clearDom()}),this.setValue(o,this.type),this.editor._onAction("editValue",{node:this,oldValue:n,newValue:o,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()}),d&&(c?d.insertBefore(this.getDom(),c):d.appendChild(this.getDom())),this.showChilds(),this.updateDom({recurse:!0})
}if(this.dom.value&&"List"!=this.type.getType()&&"Dict"!=this.type.getType()&&"Choice"!=this.type.getType()&&"Anything"!=this.type.getType())var i=t.getInnerText(this.dom.value);if(void 0!=i)try{var p;if("String"==this.type.getType())p=this._unescapeHTML(i);else{var u=this._unescapeHTML(i);p=this._stringCast(u)}p!==this.value&&(n=this.value,this.value=p,this.editor._onAction("editValue",{node:this,oldValue:n,newValue:p,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()}))}catch(f){if(this.value=void 0,1!=e)throw f}}},r.prototype._updateDomValue=function(){var e=this.dom.value;if(e){var i=this.value,n=this.type.getType(),o="String"==n&&t.isUrl(i),s="";s=o&&!this.editable.value?"":"String"==n?"green":"Number"==n?"red":"Boolean"==n?"darkorange":this._hasChilds()?"":null===i?"#004ED0":"black",e.style.color=s;var r=""==String(this.value)&&"List"!=this.type.getType()&&"Dict"!=this.type.getType()&&"Constructor"!=this.type.getType()&&"Anything"!=this.type.getType();if(r?t.addClassName(e,"empty"):t.removeClassName(e,"empty"),o?t.addClassName(e,"url"):t.removeClassName(e,"url"),"List"==n||"Dict"==n){var a=this.childs?this.childs.length:0;e.title=this.type.getType()+" containing "+a+" items"}else"string"==n&&t.isUrl(i)?this.editable.value&&(e.title="Ctrl+Click or Ctrl+Enter to open url in new window"):e.title="";this.searchValueActive?t.addClassName(e,"highlight-active"):t.removeClassName(e,"highlight-active"),this.searchValue?t.addClassName(e,"highlight"):t.removeClassName(e,"highlight"),"Choice"!=n&&"Anything"!=n&&t.stripFormatting(e)}},r.prototype._updateDomField=function(){var e=this.dom.field;if(e){var i=""==String(this.field)&&"List"!=this.parent.type.getType();i?t.addClassName(e,"empty"):t.removeClassName(e,"empty"),this.searchFieldActive?t.addClassName(e,"highlight-active"):t.removeClassName(e,"highlight-active"),this.searchField?t.addClassName(e,"highlight"):t.removeClassName(e,"highlight"),t.stripFormatting(e)}},r.prototype._getDomField=function(e){if(this.dom.field&&this.fieldEditable&&(this.fieldInnerText=t.getInnerText(this.dom.field)),void 0!=this.fieldInnerText)try{var i=this._unescapeHTML(this.fieldInnerText);if(i!==this.field){var n=this.field;this.field=i,this.editor._onAction("editField",{node:this,oldValue:n,newValue:i,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()})}}catch(o){if(this.field=void 0,1!=e)throw o}},r.prototype.clearDom=function(){this.dom={}},r.prototype.getDom=function(){var e=this.dom;if(e.tr)return e.tr;if(this._updateEditability(),e.tr=document.createElement("tr"),e.tr.node=this,"tree"===this.editor.options.mode){var t=document.createElement("td");if(this.editable.field&&this._isRemovable()){var i=document.createElement("button");e.drag=i,i.className="dragarea",i.title="Drag to move this element",t.appendChild(i)}e.tr.appendChild(t)}var n=document.createElement("td");return e.tr.appendChild(n),e.tree=this._createDomTree(),n.appendChild(e.tree),this.updateDom({updateIndexes:!0}),e.tr},r.prototype._onDragStart=function(e){var i=this;this.mousemove||(this.mousemove=t.addEventListener(document,"mousemove",function(e){i._onDrag(e)})),this.mouseup||(this.mouseup=t.addEventListener(document,"mouseup",function(e){i._onDragEnd(e)})),this.editor.highlighter.lock(),this.drag={oldCursor:document.body.style.cursor,startParent:this.parent,startIndex:this.parent.childs.indexOf(this),mouseX:e.pageX,level:this.getLevel()},document.body.style.cursor="move",e.preventDefault()},r.prototype._onDrag=function(e){var i,n,o,s,l,h,d,c,p,u,f,m,v,g,y=e.pageY,C=e.pageX,b=!1;if(i=this.dom.tr,p=t.getAbsoluteTop(i),m=i.offsetHeight,p>y){n=i;do n=n.previousSibling,d=r.getNodeFromTarget(n),u=n?t.getAbsoluteTop(n):0;while(n&&u>y);d&&!d.parent&&(d=void 0),d||(h=i.parentNode.firstChild,n=h?h.nextSibling:void 0,d=r.getNodeFromTarget(n),d==this&&(d=void 0)),d&&(n=d.dom.tr,u=n?t.getAbsoluteTop(n):0,y>u+m&&(d=void 0)),d&&d.parent===this.parent&&(d.parent.moveBefore(this,d),b=!0)}else if(l=this.expanded&&this.append?this.append.getDom():this.dom.tr,s=l?l.nextSibling:void 0){f=t.getAbsoluteTop(s),o=s;do c=r.getNodeFromTarget(o),o&&(v=o.nextSibling?t.getAbsoluteTop(o.nextSibling):0,g=o?v-f:0,1==c.parent.childs.length&&c.parent.childs[0]==this&&(p+=23)),o=o.nextSibling;while(o&&y>p+g);if(c&&c.parent){var x=C-this.drag.mouseX,E=Math.round(x/24/2),_=this.drag.level+E,N=c.getLevel();for(n=c.dom.tr.previousSibling;_>N&&n;){if(d=r.getNodeFromTarget(n),d==this||d._isChildOf(this));else{if(!(d instanceof a))break;var T=d.parent.childs;if(!(T.length>1||1==T.length&&T[0]!=this))break;c=r.getNodeFromTarget(n),N=c.getLevel()}n=n.previousSibling}l.nextSibling!=c.dom.tr&&c.parent===this.parent&&(c.parent.moveBefore(this,c),b=!0)}}b&&(this.drag.mouseX=C,this.drag.level=this.getLevel()),this.editor.startAutoScroll(y),e.preventDefault()},r.prototype._onDragEnd=function(e){var i={node:this,startParent:this.drag.startParent,startIndex:this.drag.startIndex,endParent:this.parent,endIndex:this.parent.childs.indexOf(this)};(i.startParent!=i.endParent||i.startIndex!=i.endIndex)&&this.editor._onAction("moveNode",i),document.body.style.cursor=this.drag.oldCursor,this.editor.highlighter.unlock(),delete this.drag,this.mousemove&&(t.removeEventListener(document,"mousemove",this.mousemove),delete this.mousemove),this.mouseup&&(t.removeEventListener(document,"mouseup",this.mouseup),delete this.mouseup),this.editor.stopAutoScroll(),e.preventDefault()},r.prototype._isChildOf=function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},r.prototype._createDomField=function(){return document.createElement("div")},r.prototype.setHighlight=function(e){this.dom.tr&&(this.dom.tr.className=e?"highlight":"",this.append&&this.append.setHighlight(e),this.childs&&this.childs.forEach(function(t){t.setHighlight(e)}))},r.prototype.updateValue=function(e){this.value=e,this.updateDom()},r.prototype.updateField=function(e){this.field=e,this.updateDom()},r.prototype.updateDom=function(e){function t(e){var t=document.createElement("option");t.innerHTML=e,t.setAttribute("value",e),r.appendChild(t)}var i=this.dom.tree;i&&(i.style.marginLeft=24*this.getLevel()+"px");var o=this.dom.field;if(o){this.fieldEditable?(o.contentEditable=this.editable.field,o.spellcheck=!1,o.className="field"):o.className="readonly";var s;s=void 0!=this.index?this.index:void 0!=this.field?this.field:this._hasChilds()?this.type.getType():"",o.innerHTML=this._escapeHTML(s)}var r=this.dom.value;if(r){var a=this.childs?this.childs.length:0;if("List"==this.type.getType())r.innerHTML="["+a+"]";else if("Dict"==this.type.getType())r.innerHTML="{"+a+"}";else if("Constructor"==this.type.getType())r.innerHTML=this.type.getLabel()+"(...)";else if("Choice"==this.type.getType()){r.innerHTML="";for(var l=this.value?this.value.getLabel():"",h=0;h<this.type.getChildren().length;h++){var d=document.createElement("option");d.innerHTML=this.type.getChildren()[h].getLabel(),d.setAttribute("value",this.type.getChildren()[h].getLabel()),r.appendChild(d)}r.value=l,this.editable.value||r.setAttribute("disabled",!0)}else if("Anything"==this.type.getType()){r.innerHTML="",t("Null"),t("Number"),t("String"),t("Boolean"),t("[Anything]"),t("{Anything}");for(var c in this.editor.options.knownConstructors)t(c);var p=n(this.value);if("Constructor"===p)var p=this.value?this.value.getLabel():"";r.value=p,this.editable.value||r.setAttribute("disabled",!0)}else r.innerHTML=this._escapeHTML(this.value)}this._updateDomField(),this._updateDomValue(),e&&1==e.updateIndexes&&this._updateDomIndexes(),e&&1==e.recurse&&this.childs&&this.childs.forEach(function(t){t.updateDom(e)}),this.append&&this.append.updateDom()},r.prototype._updateDomIndexes=function(){var e=this.dom.value,t=this.childs;e&&t&&("List"==this.type.getType()?t.forEach(function(e,t){e.index=t;var i=e.dom.field;i&&(i.innerHTML=t)}):"Dict"==this.type.getType()&&t.forEach(function(e){void 0!=e.index&&(delete e.index,void 0==e.field&&(e.field=""))}))},r.prototype._createDomValue=function(){var e;return"List"==this.type.getType()?(e=document.createElement("div"),e.className="readonly",e.innerHTML="[...]"):"Dict"==this.type.getType()?(e=document.createElement("div"),e.className="readonly",e.innerHTML="{...}"):"Constructor"==this.type.getType()?(e=document.createElement("div"),e.className="readonly",e.innerHTML="(...)"):"Choice"==this.type.getType()?e=document.createElement("select"):"Anything"==this.type.getType()?e=document.createElement("select"):(e=document.createElement("div"),e.contentEditable=this.editable.value,e.spellcheck=!1,e.className="value",e.innerHTML=this._escapeHTML(this.value)),e},r.prototype._createDomExpandButton=function(){var e=document.createElement("button");return this._hasChilds()?(e.className=this.expanded?"expanded":"collapsed",e.title="Click to expand/collapse this field (Ctrl+E). \nCtrl+Click to expand/collapse including all childs."):(e.className="invisible",e.title=""),e},r.prototype._createDomTree=function(){var e=this.dom,t=document.createElement("table"),i=document.createElement("tbody");t.style.borderCollapse="collapse",t.className="values",t.appendChild(i);var n=document.createElement("tr");i.appendChild(n);var o=document.createElement("td");o.className="tree",n.appendChild(o),e.expand=this._createDomExpandButton(),o.appendChild(e.expand),e.tdExpand=o;var s=document.createElement("td");s.className="tree",n.appendChild(s),e.field=this._createDomField(),s.appendChild(e.field),e.tdField=s;var r=document.createElement("td");r.className="tree",n.appendChild(r),"Dict"!=this.type.getType()&&"List"!=this.type.getType()&&"Constructor"!=this.type.getType()&&(r.appendChild(document.createTextNode(":")),r.className="separator"),e.tdSeparator=r;var a=document.createElement("td");if(a.className="tree",n.appendChild(a),e.value=this._createDomValue(),a.appendChild(e.value),e.tdValue=a,this._isRemovable()){var a=document.createElement("td");a.className="tree";var l=document.createElement("button");e.removeButton=l,l.className="remove",n.appendChild(a),a.appendChild(l)}return t},r.prototype.onEvent=function(e){var i,n=e.type,o=e.target||e.srcElement,s=this.dom,r=this,a=this._hasChilds();if(o==s.drag&&("mouseover"==n?this.editor.highlighter.highlight(this):"mouseout"==n&&this.editor.highlighter.unhighlight()),"mousedown"==n&&o==s.drag&&this._onDragStart(e),"click"==n&&o==s.expand&&a){var l=e.ctrlKey;this._onExpand(l)}"click"==n&&o===s.removeButton&&this._onRemove();var h=s.value;if(o==h)switch(n){case"focus":i=this;break;case"blur":case"change":this._getDomValue(!0),this._updateDomValue(),this.value&&"String"===this.type.getType()&&(h.innerHTML=this._escapeHTML(this.value));break;case"input":this._getDomValue(!0),this._updateDomValue();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"click":(e.ctrlKey||!this.editable.value)&&t.isUrl(this.value)&&window.open(this.value,"_blank");break;case"keyup":this._getDomValue(!0),this._updateDomValue();break;case"cut":case"paste":setTimeout(function(){r._getDomValue(!0),r._updateDomValue()},1)}var d=s.field;if(o==d)switch(n){case"focus":i=this;break;case"blur":case"change":this._getDomField(!0),this._updateDomField(),this.field&&(d.innerHTML=this._escapeHTML(this.field));break;case"input":this._getDomField(!0),this._updateDomField();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"keyup":this._getDomField(!0),this._updateDomField();break;case"cut":case"paste":setTimeout(function(){r._getDomField(!0),r._updateDomField()},1)}var c=s.tree;if(o==c.parentNode)switch(n){case"click":var p=void 0!=e.offsetX?e.offsetX<24*(this.getLevel()+1):e.pageX<t.getAbsoluteLeft(s.tdSeparator);p||a?d&&(t.setEndOfContentEditable(d),d.focus()):h&&(t.setEndOfContentEditable(h),h.focus())}if(o==s.tdExpand&&!a||o==s.tdField||o==s.tdSeparator)switch(n){case"click":d&&(t.setEndOfContentEditable(d),d.focus())}"keydown"==n&&this.onKeyDown(e)},r.prototype.onKeyDown=function(e){var i,n,o,s,l=e.which||e.keyCode,h=e.target||e.srcElement,d=e.ctrlKey,c=e.shiftKey,p=e.altKey,u=!1,f="tree"===this.editor.options.mode;if(13==l){if(h==this.dom.value)(!this.editable.value||e.ctrlKey)&&t.isUrl(this.value)&&(window.open(this.value,"_blank"),u=!0);else if(h==this.dom.expand){var m=this._hasChilds();if(m){var v=e.ctrlKey;this._onExpand(v),h.focus(),u=!0}}}else if(68==l)d&&f&&(this._onDuplicate(),u=!0);else if(69==l)d&&(this._onExpand(c),h.focus(),u=!0);else if(46==l&&f)d&&(this._onRemove(),u=!0);else if(45==l&&f)d&&!c?(this._onInsertBefore(),u=!0):d&&c&&(this._onInsertAfter(),u=!0);else if(35==l){if(p){var g=this._lastNode();g&&g.focus(r.focusElement||this._getElementName(h)),u=!0}}else if(36==l){if(p){var y=this._firstNode();y&&y.focus(r.focusElement||this._getElementName(h)),u=!0}}else if(37==l){if(p&&!c){var C=this._previousElement(h);C&&this.focus(this._getElementName(C)),u=!0}else if(p&&c&&f){if(this.expanded){var b=this.getAppend();o=b?b.nextSibling:void 0}else{var x=this.getDom();o=x.nextSibling}o&&(n=r.getNodeFromTarget(o),s=o.nextSibling,N=r.getNodeFromTarget(s),n&&n instanceof a&&1!=this.parent.childs.length&&N&&N.parent&&(N.parent.moveBefore(this,N),this.focus(r.focusElement||this._getElementName(h))))}}else if(38==l)p&&!c?(i=this._previousNode(),i&&i.focus(r.focusElement||this._getElementName(h)),u=!0):p&&c&&(i=this._previousNode(),i&&i.parent&&(i.parent.moveBefore(this,i),this.focus(r.focusElement||this._getElementName(h))),u=!0);else if(39==l){if(p&&!c){var E=this._nextElement(h);E&&this.focus(this._getElementName(E)),u=!0}else if(p&&c){x=this.getDom();var _=x.previousSibling;_&&(i=r.getNodeFromTarget(_),i&&i.parent&&i instanceof a&&!i.isVisible()&&(i.parent.moveBefore(this,i),this.focus(r.focusElement||this._getElementName(h))))}}else if(40==l)if(p&&!c)n=this._nextNode(),n&&n.focus(r.focusElement||this._getElementName(h)),u=!0;else if(p&&c&&f){n=this.expanded?this.append?this.append._nextNode():void 0:this._nextNode(),o=n?n.getDom():void 0,s=1==this.parent.childs.length?o:o?o.nextSibling:void 0;var N=r.getNodeFromTarget(s);N&&N.parent&&(N.parent.moveBefore(this,N),this.focus(r.focusElement||this._getElementName(h))),u=!0}u&&(e.preventDefault(),e.stopPropagation())},r.prototype._onExpand=function(e){if(e){var t=this.dom.tr.parentNode,i=t.parentNode,n=i.scrollTop;i.removeChild(t)}this.expanded?this.collapse(e):this.expand(e),e&&(i.appendChild(t),i.scrollTop=n)},r.prototype._onRemove=function(){this.editor.highlighter.unhighlight();var e=this.parent.childs,t=e.indexOf(this),i=this.editor.getSelection();e[t+1]?e[t+1].focus():e[t-1]?e[t-1].focus():this.parent.focus();var n=this.editor.getSelection();this.parent._remove(this),this.editor._onAction("removeNode",{node:this,parent:this.parent,index:t,oldSelection:i,newSelection:n})},r.prototype._onDuplicate=function(){var e=this.editor.getSelection(),t=this.parent._duplicate(this);t.focus();var i=this.editor.getSelection();this.editor._onAction("duplicateNode",{node:this,clone:t,parent:this.parent,oldSelection:e,newSelection:i})},r.prototype._onInsertBefore=function(e,t,i){var n=this.editor.getSelection(),o=new r(this.editor,{field:void 0!=e?e:"",value:void 0!=t?t:"",type:i});o.expand(!0),this.parent.insertBefore(o,this),this.editor.highlighter.unhighlight(),o.focus("field");var s=this.editor.getSelection();this.editor._onAction("insertBeforeNode",{node:o,beforeNode:this,parent:this.parent,oldSelection:n,newSelection:s})},r.prototype._onInsertAfter=function(e,t,i){var n=this.editor.getSelection(),o=new r(this.editor,{field:void 0!=e?e:"",value:void 0!=t?t:"",type:i});o.expand(!0),this.parent.insertAfter(o,this),this.editor.highlighter.unhighlight(),o.focus("field");var s=this.editor.getSelection();this.editor._onAction("insertAfterNode",{node:o,afterNode:this,parent:this.parent,oldSelection:n,newSelection:s})},r.prototype._onAppend=function(e,t,i){var n=this.editor.getSelection(),o=new r(this.editor,{field:void 0!=e?e:"",value:void 0!=t?t:"",type:i});o.expand(!0),this.parent.appendChild(o),this.editor.highlighter.unhighlight(),o.focus("field");var s=this.editor.getSelection();this.editor._onAction("appendNode",{node:o,parent:this.parent,oldSelection:n,newSelection:s})},r.prototype.getAppend=function(){return this.append||(this.append=new a(this.editor),this.append.setParent(this)),this.append.getDom()},r.getNodeFromTarget=function(e){for(;e;){if(e.node)return e.node;e=e.parentNode}return void 0},r.prototype._previousNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var i=t;do i=i.previousSibling,e=r.getNodeFromTarget(i);while(i&&e instanceof a&&!e.isVisible())}return e},r.prototype._nextNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var i=t;do i=i.nextSibling,e=r.getNodeFromTarget(i);while(i&&e instanceof a&&!e.isVisible())}return e},r.prototype._firstNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var i=t.parentNode.firstChild;e=r.getNodeFromTarget(i)}return e},r.prototype._lastNode=function(){var e=null,t=this.getDom();if(t&&t.parentNode){var i=t.parentNode.lastChild;for(e=r.getNodeFromTarget(i);i&&e instanceof a&&!e.isVisible();)i=i.previousSibling,e=r.getNodeFromTarget(i)}return e},r.prototype._previousElement=function(e){var t=this.dom;switch(e){case t.value:if(this.fieldEditable)return t.field;case t.field:if(this._hasChilds())return t.expand;case t.expand:if(t.drag)return t.drag;default:return null}},r.prototype._nextElement=function(e){var t=this.dom;switch(e){case t.drag:if(this._hasChilds())return t.expand;case t.expand:if(this.fieldEditable)return t.field;case t.field:if(!this._hasChilds())return t.value;default:return null}},r.prototype._getElementName=function(e){var t=this.dom;for(var i in t)if(t.hasOwnProperty(i)&&t[i]==e)return i;return null},r.prototype._hasChilds=function(){if("Choice"===this.type.getType()){for(var e=0;e<this.type.getChildren().length;e++)if(this.type.getChildren()[e].getChildren().length>0)return!0;return!1}return"Anything"===this.type.getType()?!0:this.type.getChildren().length>0},r.prototype._isRemovable=function(){if(this.parent){var e=this.parent.type.getType();return this.editable.value&&"List"===e||"Dict"===e}return!1},r.prototype._stringCast=function(e){var t=e.toLowerCase(),i=Number(e),n=parseFloat(e);return""==e?"":"null"==t?null:"true"==t?!0:"false"==t?!1:isNaN(i)||isNaN(n)?e:i},r.prototype._escapeHTML=function(e){var t=String(e).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/  /g," &nbsp;").replace(/^ /,"&nbsp;").replace(/ $/,"&nbsp;"),i=JSON.stringify(t);return i.substring(1,i.length-1)},r.prototype._unescapeHTML=function(e){var i='"'+this._escapeJSON(e)+'"',n=t.parse(i);return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;|\u00A0/g," ")},r.prototype._escapeJSON=function(e){for(var t="",i=0,n=e.length;n>i;){var o=e.charAt(i);"\n"==o?t+="\\n":"\\"==o?(t+=o,i++,o=e.charAt(i),-1=='"\\/bfnrtu'.indexOf(o)&&(t+="\\"),t+=o):t+='"'==o?'\\"':o,i++}return t};var a=e(r);return r}.apply(t,n),!(void 0!==o&&(e.exports=o))},function(e,t,i){var n,o;n=[i(2)],o=function(){function e(e){function t(e){this.editor=e,this.dom={}}return t.prototype=new e,t.prototype.getDom=function(){var e=this.dom;if(e.tr)return e.tr;this._updateEditability();var t=document.createElement("tr");t.node=this,e.tr=t,this.editable.field&&(e.tdDrag=document.createElement("td"));var i=document.createElement("td");i.className="appenditem";var n=document.createElement("div");n.innerHTML="(empty)",n.className="readonly";var o=document.createElement("div");return o.className="icon",i.appendChild(o),i.appendChild(n),e.td=i,e.text=n,this.updateDom(),t},t.prototype.updateDom=function(){var e=this.dom,t=e.td;t&&(t.style.paddingLeft=24*this.getLevel()+26+"px");var i=e.text;i&&(i.innerHTML="Extend "+this.parent.type.getType());var n=e.tr;this.isVisible()?e.tr.firstChild||(e.tdDrag&&n.appendChild(e.tdDrag),n.appendChild(t)):e.tr.firstChild&&(e.tdDrag&&n.removeChild(e.tdDrag),n.removeChild(t))},t.prototype.isVisible=function(){return this.editable.value&&("List"==this.parent.type.getType()||"Dict"==this.parent.type.getType())},t.prototype.onEvent=function(e){{var t=e.type;e.target||e.srcElement,this.dom}if("click"==t){var i=this.parent.type.getChildren()[0],n=i.buildDefaultValue();this._onAppend("",n,i)}else"keydown"==t&&this.onKeyDown(e)},t}return e}.apply(t,n),!(void 0!==o&&(e.exports=o))}])});
//# sourceMappingURL=jsoneditor.map